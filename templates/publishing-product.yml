steps:
- checkout: self

- task: CmdLine@2
  displayName: 'Login Org QA'
  inputs:
    script: 'apic login -s $(server-apic) -r $(region-apic)  -u $(user-apic-qa) -p $(pass-apic-qa)'

- task: CmdLine@2
  displayName: 'List all products'
  inputs:
    script: 'apic products:list-all -s $(server-apic) -o $(name-apic-qa) --scope catalog --catalog  qa'

- task: CmdLine@2
  displayName: 'Recreating APIs'
  inputs:
    script: |
      apic draft-apis:create templates\assets\$(name-api-001)_$(version-api-001).yaml -s $(server-apic) -o $(name-apic-qa)
      apic draft-apis:create templates\assets\$(name-api-002)_$(version-api-002).yaml -s $(server-apic) -o $(name-apic-qa)

- task: CmdLine@2
  displayName: 'Recreating product'
  inputs:
    script: |
      apic draft-products:create  templates\assets\$(name-product)_$(version-product).yaml -s $(server-apic) -o $(name-apic-qa) --format json

- task: CmdLine@2
  displayName: 'List all products'
  inputs:
    script: 'apic draft-products:list-all -s $(server-apic) -o $(name-apic-qa)'


- task: CmdLine@2
  displayName: 'Pubish product'
  inputs:
    script: |
      apic draft-products:publish  $(name-product):$(version-product) -s $(server-apic) -o $(name-apic-qa) --scope catalog -c qa --format json

- task: CmdLine@2
  displayName: 'List all products'
  inputs:
    script: 'apic products:list-all -s $(server-apic) -o $(name-apic-qa) --scope catalog --catalog  qa'

- task: CmdLine@2
  displayName: 'Logout Org QA'
  inputs:
    script: 'apic logout -s $(server-apic)'